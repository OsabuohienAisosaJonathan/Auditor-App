FIX SALES CAPTURE POSTING + FILTERS + SUMMARY (DB CONNECTED) + SYNC WITH AUDIT WORKSPACE

You are working on Miemploya AuditOps. The Sales Capture page loads but sales entries are not posting/saving, and the filters + summary panels are not reflecting database data. Fix this page end-to-end so it persists to the database and stays in sync with Audit Workspace → Sales step.

1) Core requirement

Sales Capture must create, read, update, delete sales entries stored in the DB and filtered by:

selected Client

selected Department

selected Date (daily)
Sales Capture and Audit Workspace must read/write to the same sales tables/endpoints so an entry created in one appears instantly in the other.

2) Fix “Record Sales” / “Record First Entry” (posting not working)

Ensure the “Record Sales” and “Record First Entry” buttons open a working modal/form and successfully submit.

The form must include required fields:
a. clientId (from top header selection)
b. departmentId (from department dropdown selection)
c. date (from date picker)
d. shift (Full Day / Morning / Night)
e. cashAmount, posAmount, transferAmount, voidsCompAmount (default 0)
f. notes (optional)

On submit:

validate required fields

call backend API

on success: close modal, toast success, and refresh list + summary without page reload

Fix any runtime errors, wrong route paths, or missing API calls that prevent posting.

3) Backend API (must be real and used by both Sales Capture and Audit Workspace)

Implement or confirm these endpoints exist and work in production:

GET /api/sales?clientId=&departmentId=&date= → returns list of entries for the day

POST /api/sales → creates a sales entry

PUT /api/sales/:id → updates an entry

DELETE /api/sales/:id → deletes an entry

GET /api/sales/summary?clientId=&departmentId=&date= → returns totals (cash, pos, transfer, voids, grandTotal, entriesCount, avgPerEntry)

Rules:

All reads must filter by clientId + departmentId + date

Use the same schema for Audit Workspace sales step so they share data

Return consistent JSON shapes and handle empty results gracefully

4) Make the list area actually render entries

Replace any placeholder/empty-state logic that incorrectly triggers “No sales entries yet”.

When entries exist, show them in a table with:

time created

shift

cash

pos

transfer

voids/comp

total

actions: edit / delete

Ensure the UI refreshes after create/edit/delete using proper state invalidation (not cached stale data).

5) Filters must work (Search + Filter button)

Search box must filter sales entries by:

shift

notes

createdBy (if present)

Filter button must allow:

shift filter

payment method filter (cash/pos/transfer)

amount range (optional)

Filters must apply both to the list and to the summary totals (do not show totals for data outside the current filters).

6) Summary container must be DB-driven

The Summary panel (Total Cash, Total POS, Total Transfer, Grand Total) must:

Compute from DB records for selected client/department/date

Update immediately when:

a new sale is posted

an entry is edited/deleted

client/department/date filter changes

Quick Stats panel must also be DB-driven:

Entries Count

Avg per Entry

7) Sync with Audit Workspace (mandatory)

Sales Capture is linked to Audit Workspace, so:

When user posts sales in Sales Capture, the same records must appear in Audit Workspace → Sales tab for the same client/department/date.

When user posts sales in Audit Workspace → Sales tab, the same records must appear in Sales Capture.

If Audit Workspace uses summary mode table, ensure it writes into the same /api/sales endpoint (not a separate temporary draft store).

Ensure “Complete Sales Step” in Audit Workspace checks whether sales exist for the selected client/department/date and uses the saved records.

8) Production reliability

This must work after publishing:

ensure API base URL/env vars are correct

ensure DB migrations exist and run

remove any dev-only mocks

show meaningful errors instead of silent failure

9) Acceptance test (must demonstrate)

Select client “igh”, department “Bar”, date Dec 27, 2025

Click Record Sales → enter Cash 50,000, POS 20,000, Transfer 10,000 → Save

Entry must appear in list immediately

Summary must update to match totals

Navigate to Audit Workspace → Sales tab → the same entry must be visible/totaled

Edit entry → totals update in both places

Delete entry → totals drop and empty state only shows when no entries remain